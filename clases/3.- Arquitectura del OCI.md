## Arquitectura de OCI

### Visión general del OCI

- Recursos informaticos disponibles

![alt recursos_informaticos](/imagenes/clase03/recursos_informaticos.png)

- Almacenamiento

![alt almacenamiento](/imagenes/clase03/almacenamiento.png)

- Red

![alt red](/imagenes/clase03/red.png)

- Oracle Database

![alt oracle_database](/imagenes/clase03/oracle_database.png)

- Bases de datos

![alt bases_datos](/imagenes/clase03/bases_datos.png)

** Opciones mas avanzadas disponibles **

- Analisis y a Inteligencia artificial

![alt analisis_ia](/imagenes/clase03/analisis_ia.png)

- Servicios para desarrolladores

![alt servicios_desarrollador](/imagenes/clase03/servicios_desarrollador.png)

- Identidad y seguridad

![alt identidad_seguridad](/imagenes/clase03/identidad_seguridad.png)

- Observacion y gestion

![alt observacion_gestion](/imagenes/clase03/observacion_gestion.png)

- Hibrido, para crear maquinas virtuales por software

![alt hibrido](/imagenes/clase03/hibrido.png)

- Migracion y Recuperacion ante desastres, tambien se usa para migrar volumenes de datos

![alt migracion](/imagenes/clase03/migracion.png)

- Gestion de facturacion y costos

![alt facturacion](/imagenes/clase03/facturacion.png)

- Gobernanza y administracion

![alt gobernanza](/imagenes/clase03/gobernanza.png)

- Marketplace

![alt marketplace](/imagenes/clase03/marketplace.png)

- Servicios de OCI classic

![alt oci_classic](/imagenes/clase03/oci_classic.png)

La documentacion de OCI esta en: https://docs.oracle.com/es-ww/iaas/Content/GSG/Concepts/baremetalintro.htm
Video: https://youtu.be/JBkT44FSf0o


## Compartimientos

Los compartimentos son recursos importantes dentro de Oracle Cloud y proveen un namespace lógico global donde políticas pueden ser implementadas, como carpetas en un sistema de archivos. Por ser globales, se extienden a todas las regiones OCI.

Por ejemplo, los compartments pueden reflejar una estructura funcional de la organización, donde cada departamento tiene un compartment con un administrador designado. Cada compartment de departamento, puede tener subcompartments para diferentes ambientes (Dev, Test, Prod), cada uno con sus propios administradores

- Opcion ubicada en identidad y seguridad-> compartimientos, es como una carpeta donde se pueden fijar las politicas de acceso a los servicios separados por permisos definidos alli de manera logica
- Alli aparece el compartimiento raiz con que se creo el OCI, ahora tambien se definen las cuotas o limites de uso a los grupos en las politicas

- Compartimiento

![alt compartimiento](/imagenes/clase03/compartimiento.png)

- Crear 2 compartimientos, uno de desarrollo y otro de produccion

![alt crear_compartimiento](/imagenes/clase03/crear_compartimiento.png)

![alt ambiente_dev](/imagenes/clase03/ambiente_dev.png)

![alt ambiente_prod](/imagenes/clase03/ambiente_prod.png)

![alt compartimientos_creados_1](/imagenes/clase03/compartimientos_creados_1.png)

Documentacion completa de compartimientos: https://docs.oracle.com/es-ww/iaas/Content/Identity/compartments/managingcompartments.htm

Video: https://www.youtube.com/embed/VJD19vyu6lI

![alt esquema_compartimientos](/imagenes/clase03/esquema_compartimiento.png)

Aprendimos cómo crear compartimentos, que tiene por objetivo promover el isolamiento de seguridad y control de acceso dentro de la nube. Esto se logra a través de un namespace lógico global, donde las políticas de seguridad pueden ser aplicadas. Por medio de la aplicación de políticas, podemos definir un nivel de acceso adecuado dependiendo de los parámetros definidos por la organización para el gerenciamiento de recursos.

De esta manera la creación de compartimentos será nuestra primera opcion dentro de OCI antes de dar continuidad al proceso de implementación de nuestro proyecto.

![alt compartimientos_creados](/imagenes/clase03/compartimientos_creados.png)

## Usuarios

- Crear usuarios
- Crear grupos
- Crear politicas y permisos para usar recursos

- Ruta: Identidad->Dominios->Dominio Default->Usuarios

![alt usuarios](/imagenes/clase03/usuarios.png)

- se puede crear primero el grupo y luego el usuario, o al contrario, el resultado es el mismo, la idea es crear el usuario y grupo para administrar nuestra petshop **doguito**

creando usuario sin grupo: no puede ser el mismo correo como en el video, 

![alt usuario_sin_grupo](/imagenes/clase03/usuario_sin_grupo.png)

![alt usuario_sin_grupo_2](/imagenes/clase03/usuario_sin_grupo_2.png)

- luego vamos a grupos y creamos un nuevo grupo

![alt grupo_doguito](/imagenes/clase03/grupo_doguito.png)

- luego se crea una politica en identidad->politica

![alt politicas](/imagenes/clase03/politicas.png)

- se crea la politica para doguito, seleccionando el compartimiento "desarrollo" donde tendran los permisos, usando la plantilla que dice :

    "permitir que los administradores gestionen configuraciones de la instancias, pool de instancias y redes de cluster de computers"

![alt politica_1](/imagenes/clase03/politica_1.png)

esta plantilla genera un codigo que se va a corregir, habilitando el boton "mostrar editor manual"

![alt politica_2](/imagenes/clase03/politica_2.png)

se cambiará el codigo:

    Allow group 'Default'/'grupo_tienda_doguito' to manage compute-management-family in compartment desarrollo

- cambiamos el permiso "compute-management-family" por  "all-resources" 

    Allow group 'Default'/'grupo_tienda_doguito' to manage all-resources in compartment desarrollo

![alt politica_3](/imagenes/clase03/politica_3.png)

![alt politica_4](/imagenes/clase03/politica_4.png)

al correo agregado le llega una invitacion para configurar su cuenta y clave de acceso, se puede usar una pestaña incognito para validar que este funcionando bien.

- se valida el usuario, se activa la doble autenticacion

![alt validando_user](/imagenes/clase03/validando_user.png)

- alli muestra a que grupos pertenece y a que aplicaciones tiene acceso

![alt doguito_user1](/imagenes/clase03/doguito_user1.png)

![alt doguito_user2](/imagenes/clase03/doguito_user2.png)

- observo que se demora, no salen las cosas que deberian salir, me toco entrar y salir varias veces hasta que se activo el usuario, ojo al ingresar se debe colocar primero el arrendatario o tenant y luego el usuario y clave, en mi caso el tenant es "sanchezluys"

![alt usuario_in](/imagenes/clase03/usuario_in.png)

- se valida y solo tiene acceso al compartimiento de desarrollo tal como debe ser:

![alt compartimiento_para_doguito](/imagenes/clase03/compartimiento_doguito.png)

## IAM en OCI

Cuando hablamos de aplicaciones de empresas, el control de acceso a los recursos es esencial para que no ocurran incidentes como fallas de seguridad dentro de nuestra aplicación, Para eso, OCI implementa un modelo avanzado de identidad y control de acceso, si quieres aprender más detalles sobre IAM asiste el siguiente video (El video fue realizado en el idioma inglés pero puedes activar los subtítulos en español).

https://youtu.be/8qaQuoJZYvQ

Documentacion oficial:  https://docs.oracle.com/es-ww/iaas/Content/Identity/iam/manage-iam.htm

Vimos cómo crear nuevos usuarios dentro de ORacle Cloud para segregar el nivel de acceso a las diferentes funcionalidades de OCI

Al crear tu cuenta por primera vez tendrás acceso a un usuario con permisos de administrador raíz(root). Eso significa que tienes el control sobre toda la cuenta y sobre todos los recursos de OCI. Sin embargo, este usuario debe ser utilizado para gerenciar otros usuarios, grupos y políticas. Debemos crear un nuevo usuario que tenga permisos solamente para el compartimento que creamos anteriormente

## Cloud Shell

- El nuevo usurio en su politica no tiene habilitado el uso del shell

![alt shell_sin_permiso](/imagenes/clase03/shell_sin_permiso.png)

- Por lo que es necesario habilitar este permiso usando el usuario administrador raiz o principal

![alt revisando_politica_doguito](/imagenes/clase03/revisando_politica_doguito.png)

- Editar politica

![alt editar_politica_doguito](/imagenes/clase03/editar_politica_doguito.png)

- Se agrega otra sentencia

![alt agrega_sentencia](/imagenes/clase03/agrega_sentencia.png)

- Se agrega esta nuevo permiso:

    Allow group 'Default'/'grupo_tienda_doguito' to use cloud-shell in tenancy

![alt nuevo_permiso_shell](/imagenes/clase03/nuevo_permiso_shell.png)

- Ahora si tiene el permiso de usar el shell

![alt permiso_shell_activado](/imagenes/clase03/permiso_shell_activado.png)

## Llaves SSH: por seguridad es necesario activar llaves

- se necesita generar una llave privada y una publica para usar ssh
- la llave publica pide una clave que se puede dejar en blanco, "Enter passphrase (empty for no passphrase):"

```linux
    pwd     /* para ver en que directorio me encuentro */
            /* en mi caso: /home/luys_colom */
    ls      /* muestra archivos, en nuestro caso esta vacio */
    ls -a   /* muestra los archivos inlcuyendo los ocultos */
            /*   ..  .bash_history  .bash_logout  .bash_profile  .bashrc  .cstutorial.conf  .emacs  .npm */
    mkdir .ssh 
            /* para crear el directorio para las llaves */
    cd .ssh /* cambiando al directorio .ssh */
    ssh -keygen -b 2048 -t rsa -f cloudshellkey
    Enter passphrase (empty for no passphrase):
    Enter same passphrase again: 
    Your identification has been saved in cloudshellkey.
    Your public key has been saved in cloudshellkey.pub.
    The key fingerprint is:
    SHA256:/Vs+ep6Jk5okXKsQai29d+ckWaPpUAvV2pKwHBtXy74 luys_colom@3848acec55ea
    The key's randomart image is:
    +---[RSA 2048]----+
    |            .    |
    |           + .   |
    |                 |
    |                 |
    |      . S B =    |
    |                 |
    |              .  |
    |                 |
    |      ....++===. |
    +----[SHA256]-----+
    /* se modifica esta info del rsa por seguridad */
    ls -a
    .  ..  cloudshellkey  cloudshellkey.pub
```
- creando el directorio .ssh

![alt ssh_directorio](/imagenes/clase03/ssh_directorio.png)


En esta clase vimos que para que un usuario pueda acceder a Cloud Shell es necesario que tenga las políticas definidas adecuadamente. Para eso tenemos que acceder al área de Identidad y Seguridad de OCI y crear una política para permitir que usuarios del grupo puedan utilizar Cloud Shell.

En seguida debemos acceder a Cloud Shell como un usuario administrador para poder realizar la creación de las llaves SSh que utilizaremos para acceder a las instancias que crearemos después.

Lo que aprendimos en esta aula:

La arquitectura de OCI está compuesta por una serie de elementos como instancias de computación, almacenamiento, redes, bases de datos, políticas de identidad y seguridad, entre otros.
Creamos usuarios, grupos y políticas dentro de OCU para controlar el acceso a funcionalidades.
Vimos algunos comandos básicos para poder generar una llave RSA dentro de Cloud Shell, la cual nos permite realizar una conexión segura con las instancia