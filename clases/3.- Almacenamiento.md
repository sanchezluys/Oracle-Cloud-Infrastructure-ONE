## Almacenamiento en OCI

- Existen 3 tipos, por bloques, de archivos y de objetos


![alt almacenamientos](/imagenes/clase03/almacenamientos.png)

## Consideraciones:

1. Persistencia: si necesita mantenerse o no

2. Tipo de dato:

3. Tipo de performance:

4. Capacidad de almacenamiento: 

5. Operaciones de entrada/salida por segundo

6. Velocidad de Transferencia:

7. Durabilidad: copias que aseguren el dato

8. Forma de conexion:

9. Protocolo:


## Almacenamiento de bloques

- es como un disco ssd
- es rapido
- se puede definir el tamaño
- se puede acoplar o desaclopar de la instancia
- se puede acoplar a otras instancias
- la instancia es la responsable del como y cuando se almacenan los datos

![alt en_bloques](/imagenes/clase03/en_bloques.png)

![alt bloques_1](/imagenes/clase03/bloques_1.png)

![alt bloques_2](/imagenes/clase03/bloques_2.png)

## Almacenamiento de archivos

- se almacenan de una manera jerárquica
- usa NFS (Network File System)
- se puede usar para acceder a datos de una o mas instancias
- ayuda a compartir los datos entre instancias



![alt de_archivos](/imagenes/clase03/de_archivos.png)

![alt arch_1](/imagenes/clase03/arch_1.png)

![alt arch_2](/imagenes/clase03/arch_2.png)

## Almacenamiento de objetos

- cubo: se guardan como clave-valor cualquier archivo
- se puede acceder a cada objeto por medio de una URL
- se deben definir las políticas
- usa un sistema plano, permite simular carpetas o directorios
- puede almacenar html, javascript, lo que lo hace útil para crear el frontend


![alt objetos_1](/imagenes/clase03/objetos_1.png)

![alt objetos_2](/imagenes/clase03/objetos_2.png)

![alt objetos_3](/imagenes/clase03/objetos_3.png)

- cuando se crea el cubo se agregan los objetos:

![alt objetos_4](/imagenes/clase03/objetos_4.png)

- cuando se crea el objeto, en los 3 puntos del objeto se ve el detalle de objeto donde indica la URL

![alt objetos_5](/imagenes/clase03/objetos_5.png)

- para que los objetos sean accesibles desde internet es necesario configurar el cubo en visibilidad

![alt objetos_6](/imagenes/clase03/objetos_6.png)

- cada objeto tiene un namespace unico, y esta en al URL

![alt namespace](/imagenes/clase03/namespace.png)


## Doguito en Object Storage

- Niveles de acceso (su nivel afecta el costo del servicio), se puede automatizar con organizacion automatica
    1. Estandar, acceso a datos de manera frecuente  (imagenes, archivos)
    2. Infrecuente, o frio, no siempre tenemos que acceder a los datos (por ejemplo un respaldo )
    3. Archivo frio, el archivo se almacena pero no se tiene acceso en mucho tiempo (ejemplo almacenar logs, 90 dias)

![alt niveles_acceso](/imagenes/clase03/niveles_acceso.png)

### Creando el cubo

- se debe colocar publico el cubo
- las conexiones https solo se conectan con conexiones https por seguridad si se intenta con http se bloquea


![alt cubo_1](/imagenes/clase03/cubo_1.png)

![alt cubo_2](/imagenes/clase03/cubo_2.png)

![alt cubo_3](/imagenes/clase03/cubo_3.png)

![alt cubo_4](/imagenes/clase03/cubo_4.png)

![alt cubo_5](/imagenes/clase03/cubo_5.png)


Aprendimos a crear un bucket público de un Object Storage que nos permitió servir la página estática de Doguito, o sea, archivos HTML, CSS y JavaScript de manera muy simple y práctica.

Llegó tu vez de hacer lo mismo. Para eso, será necesario hacer la descarga del archivo del curso “doguito-site-object-storage.zip” en zip, crear un bucket y hacer el upload de los archivos.

- Cargando los datos al cubo

![alt datos_1](/imagenes/clase03/datos_1.png)

![alt datos_2](/imagenes/clase03/datos_2.png)

![alt datos_3](/imagenes/clase03/datos_3.png)

![alt objetos](/imagenes/clase03/objetos.png)

- sitio web funcionando con la falla del https-http

![alt site_1](/imagenes/clase03/site_1.png)

link: https://objectstorage.sa-bogota-1.oraclecloud.com/n/axc9d1jhetjs/b/bucket-site/o/index.html


## SSL en Load Balancer

- Es necesario crear un certicado ssl para corregir el error con https y http
- En cloud-shell

```bash
    // la frase por defecto puede ser doguito y lo demas en blanco.
    luys_colom@cloudshell:~ (sa-bogota-1)$ openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -sha256 -days 365
    Generating a 4096 bit RSA private key
    ***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************++++
    **************************************++++
    writing new private key to 'key.pem'
    Enter PEM pass phrase:
    Verifying - Enter PEM pass phrase:
    -----
    You are about to be asked to enter information that will be incorporated
    into your certificate request.
    What you are about to enter is what is called a Distinguished Name or a DN.
    There are quite a few fields but you can leave some blank
    For some fields there will be a default value,
    If you enter '.', the field will be left blank.
    -----
    Country Name (2 letter code) [XX]:
    State or Province Name (full name) []:
    Locality Name (eg, city) [Default City]:
    Organization Name (eg, company) [Default Company Ltd]:
    Organizational Unit Name (eg, section) []:
    Common Name (eg, your name or your server's hostname) []:
    Email Address []:
    luys_colom@cloudshell:~ (sa-bogota-1)$ 

    luys_colom@cloudshell:~ (sa-bogota-1)$ ls
    cert.pem  key.pem

```

- Luego estos archivos se usan el load balancer.
- vamos al load balancer, bajamos a backends donde deben estar las 2 instancias creadas:

![alt load_1](/imagenes/clase03/load_ssl/image.png)

- luego se baja hasta encontrar los certificados

![alt load_2](/imagenes/clase03/load_ssl/image-1.png)

- luego en certifcados cambiar la opcion por defecto de "certificado gestionado de servicio certificado" por "certificado gestionado de equilibrador de carga"

![alt load_3](/imagenes/clase03/load_ssl/image-2.png)

- luego ahora asi se agrega el certificado:

![alt load_4](/imagenes/clase03/load_ssl/image-3.png)

- configurando el certificado:

![alt load_4](/imagenes/clase03/load_ssl/image-4.png)

- es necesario agregar el archivo .pem

![alt load_5](/imagenes/clase03/load_ssl/image-5.png)

- en cloud shell se pueden subir y descargar archivos, en este caso necesitamos descargar al computador el cert.pem y el key.pem

![alt load_6](/imagenes/clase03/load_ssl/image-6.png)

![alt load_7](/imagenes/clase03/load_ssl/image-7.png)

![alt load_8](/imagenes/clase03/load_ssl/image-8.png)


- se puede arrastrar el archivo cert.pem al certificado, como clave privada:

![alt load_9](/imagenes/clase03/load_ssl/image-9.png)

- bajamos y agregamos el key.pem 

![alt load_10](/imagenes/clase03/load_ssl/image-10.png)

- importante aqui se coloca la clave privada que se dijo que seria "doguito", cuando de creó el certificado

![alt load_11](/imagenes/clase03/load_ssl/image-11.png)

- se muestra la solicitud enviada

![alt load_12](/imagenes/clase03/load_ssl/image-12.png)

- se demora un rato en generarse, paciencia.

![alt load_13](/imagenes/clase03/load_ssl/image-13.png)

- aun el certificado no esta en el load balancer, es necesario: 
- ir  los listeners:

![alt load_14](/imagenes/clase03/load_ssl/image-14.png)

- se agrega otro listeners, para el protocolo https

![alt load_15](/imagenes/clase03/load_ssl/image-15.png)

- definir de donde se toma el certificado

![alt load_16](/imagenes/clase03/load_ssl/image-16.png)

![alt load_17](/imagenes/clase03/load_ssl/image-17.png)

- seleccionar del juego de backends y crear listeners, igual se debe esperar a que se cree el listeners

![alt load_18](/imagenes/clase03/load_ssl/image-18.png)

![alt load_19](/imagenes/clase03/load_ssl/image-19.png)

![alt load_20](/imagenes/clase03/load_ssl/image-20.png)

- aun falta, tenemos que ir a la red virtual creada vcn1, en subredes, subred publica vcn1, default security list for vcn1, se agrega otra regla de entrada,  0.0.0.0/0:tcp:443,


![alt load_21](/imagenes/clase03/load_ssl/image-21.png)

![alt load_22](/imagenes/clase03/load_ssl/image-22.png)

![alt load_23](/imagenes/clase03/load_ssl/image-23.png)

![alt load_24](/imagenes/clase03/load_ssl/image-24.png)

![alt load_25](/imagenes/clase03/load_ssl/image-25.png)

- el navegador ahora va a dar un error de privacidad

![alt load_26](/imagenes/clase03/load_ssl/image-26.png)

## Conexion https

- se elimina la segunda instancia,
- a la instancia que queda se le edita el puerto al puerto 3000, puede demorar unos segundo en activarse


![alt https_1](/imagenes/clase03/https/image.png)

![alt https_2](/imagenes/clase03/https/image-1.png)

![alt https_3](/imagenes/clase03/https/image-2.png)

- ya redirecciona a la API sin agregar el puerto 3000

![alt https_4](/imagenes/clase03/https/image-3.png)

- luego es necesario actualizar el archivo scripts.js con la direccion del balanceador, 
- se debe volver a cargar el archivo en el cubo en site, el objeto


![alt https_4](/imagenes/clase03/https/image-4.png)

![alt https_5](/imagenes/clase03/https/image-5.png)



Vimos que para que nuestro front end pueda comunicarse con la API es necesario que ambos utilicen protocolos HTTPS. De esta manera, necesitamos de un medio para acceder la API de Doguito via HTTPS.

La forma más común de hacerlo es un certificado HTTPS en el balanceador de cargas, entonces es necesario crear un certificado, importarlo en el balanceador y en seguida incluir un listener para la puesta 443 en el balanceador. Por fin, hacemos ajustes para que las requisiciones del balanceador sean direccionadas para back end en la puerta 3000.

Ajustado ese primer paso, en seguida debemos alterar el archivo script.js, que pasará a apuntar para el IP público del balanceador de cargas y utilizar el protocolo HTTPS. Ahora llegó tu vez de hacer la activación.

---

OCI ofrece diversos tipos de almacenamiento para cada caso de uso y necesidad. Cuando creamos una instancia esta está asociada a un volumen de inicialización que posee la imagen del sistema operacional para realizar el boot. En el caso de que esa instancia necesite expandir su almacenamiento o caso deseamos mantener archivos que serán preservados aunque la instancia sea destruida, debemos utilizar un tipo de almacenamiento específico para eso.

Selecciona la alternativa que corresponde al almacenamiento más adecuado para este caso.

Alternativa correcta. El servicio de volumen de bloques permite provisional y gerencias dinámicamente volúmenes de almacenamiento en bloque como si fueran una unidad de disco rígido común. También puedes desconectar un volumen y adjuntarlo a otra instancia sin pérdida de datos. Esta es la opción más adecuada para expandir la capacidad de almacenamiento de una instancia.


## Para saber más: tecnologías del Doguito

Object Storage es un concepto nuevo que se ha popularizado en diversos proveedores de Cloud. Esto se debe a su facilidad de creación y baja necesidad de manutención. Sus usos pueden variar desde la utilización para upload de contenido de usuarios hasta persistencia de configuración de las aplicaciones. Para saber un poco más de Object Storagm, asiste a este video de Oracle que explica muchas características suyas:

https://youtu.be/IePCpBGza0k

El contenido en video puede presentar algunos tópicos desactualizados, por eso, todos los detalles sobre la utilización de Almacenamiento en OCI pueden ser encontrados en la documentación oficial en la sección “Almacenamiento” a través del link:

Documentación de Oracle Cloud Infrastructure: https://docs.oracle.com/es-ww/iaas/Content/home.htm




Lo que aprendimos en esta aula:

    Que la OCI ofrece diversos tipos de almacenamientos para tu aplicación, como el almacenamiento en bloques, almacenamiento de archivos y el Object Storage. Cada categoría presenta diversas características de performance y durabilidad, debiendo ser evaluadas las necesidades específicas de cada caso de uso.
    Que Object Storage permite acceso HTTPS directo a los recursos, a partir de la definición de un namespace y de un bucket.
    Que podemos utilizar Object Storage para almacenar y servir el front end de Doguito Petshop, siendo una forma simplificada para servir una página vía HTTPS.
    Que cuando el front end es servido en HTTPS es necesario que el backend también sea servido en HTTPS para que el navegador acepte realizar requisiciones AJAX entre los dominios.

