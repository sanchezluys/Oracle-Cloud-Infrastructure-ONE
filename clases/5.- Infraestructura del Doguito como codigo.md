## IaC Doguito API

- se va a usar el numero 2
- se suprime todo lo anterior
- el numero 2 incluye a doguito-site.service, verificar que las credenciales esten bien en ese archivo
- a los demas archivos como compute.tf se le cambió fueron algunos nombres, asi como en loadbalancer.tf
- se recomienda el clonado del git, esto se configura en cloud-init.yaml
- voy a clonar y se coloca en: https://github.dev/sanchezluys/doguito-app-oci
- es necesario configurar la url wallet y doguito-site.service

    mi repo:
    https://github.com/sanchezluys/doguito-app-oci



![alt iac_1](/imagenes/clase05/iac/image.png)

Pasos:

1.  Almacenamiento - cubos - crea un cubo, todo por defecto, ejemplo nombre: interno
2.  Habilita la visibilidad del cubo de privado a publico
3.  Se cargan al cubo: doguito-site.service 

una vez se tenga el archivo cargado de doguito-site.service se mira en su detalle de objeto la url publica:

![alt iac_2](/imagenes/clase05/iac/image-1.png)

para luego pegarla en: cloud-init.yaml

![alt iac_3](/imagenes/clase05/iac/image-2.png)

![alt iac_4](/imagenes/clase05/iac/image-3.png)

4. ahora el wallet url, en oracle database - bases de datos autonomas - doguito_db - conexion de bases de datos

![alt iac_5](/imagenes/clase05/iac/image-4.png)

descargamos la cartera donde necesitamos la clave, por ejemplo es doguito12345

![alt iac_6](/imagenes/clase05/iac/image-5.png)

![alt iac_7](/imagenes/clase05/iac/image-6.png)

- se descarga y se coloca en la misma carpeta del proyecto

![alt iac_8](/imagenes/clase05/iac/image-7.png)

5. se sube la wallet.zip al cubo, para obtener la url publica del objeto y colocarla en el .yaml, linea 25 

![alt iac_9](/imagenes/clase05/iac/image-8.png)

![alt iac_10](/imagenes/clase05/iac/image-9.png)

6. una vez listo, es necesario volver a comprimir en formato .zip los archivos del proyecto ejemplo doguito-final.zip, que es el archivo que se usará para generar la pila.

![alt iac_11](/imagenes/clase05/iac/image-10.png)




¿Estás listo para crear un pilla customizada para implementar Doguito de manera extremadamente simple y práctica?

Serán necesarios algunos pasos:

    Ajustar el archivo “compute.tf” customizando el nombre de las instancias;
    Ajustar el archivo loadbalancer.tf customizando el nombre del balanceador de cargas y las puertas de conexión;
    Ajustar el archivo “network.tf” incluyendo una regla de ingreso para la puerta 3000;
    Crear un nuevo bucket llamado internal y hacer el upload de los archivos “doguito-site.service” y “Wallet_DOGUITODB.zip”;
    Alterar el “archivo cloud-init.yaml” instalando git, Node.js y los drivers de conexión con la base de datos ORacle. Inserir un comando en el archivo para hacer la descarga y configurar el service de Doguito, además de hacer la descarga de Wallet y la descompactar en el local adecuado, liberando la puerta 3000 en firewall.

Por fin, tenemos que compactar otra vez el archivo “orm-dps-vm2” en un archivo zip que será utilizado para inicializar la pilla del Doguito.

Si tienes alguna pregunta, no dudes en entrar en contacto con otras personas en nuestro fóro.

## Doguito API

- Crear pila
- se carga el archivo .zip
- version de terrafor .14.x
- luego siguiente y pegar la llave ssh
- luego siguiente
- luego crear



![alt api_1](/imagenes/clase05/api/image.png)

![alt api_2](/imagenes/clase05/api/image-1.png)

![alt api_3](/imagenes/clase05/api/image-2.png)

![alt api_4](/imagenes/clase05/api/image-3.png)

- luego se da en "plan", se ejecuta y se espera a que este listo, se puede demorar unos minutos

![alt api_5](/imagenes/clase05/api/image-4.png)

![alt api_6](/imagenes/clase05/api/image-5.png)

![alt api_7](/imagenes/clase05/api/image-6.png)

- luego en detalles de pila se le da aplicar, se demora unos minutos

![alt api_8](/imagenes/clase05/api/image-7.png)

![alt api_9](/imagenes/clase05/api/image-8.png)

![alt api_10](/imagenes/clase05/api/image-9.png)

- abajo, se ubica el log, alli se muestra la ip del balanceador de carga

![alt api_11](/imagenes/clase05/api/image-10.png)

- se valida que este funcionando el balanceador de carga, en red- balanceador de carga,
- se verifica en el detalle, donde se observa que aun esta creando las instancias
- se valida en las instancias
- se puede demorar algunos minutos, y luego accediendo a la ip del balanceador se ve ya la aplicacion funcionando.

![alt api_12](/imagenes/clase05/api/image-11.png)

![alt api_13](/imagenes/clase05/api/image-12.png)

![alt api_14](/imagenes/clase05/api/image-13.png)




Tenemos el archivo “orm-dps-v2.zip” y ahora es hora de implementarlo como una pilla en OCI. Para eso utilizamos la opción de Servicios al Desarrollador y Gerenciador de Recursos.

El proceso será muy semejante al que hicimos anteriormente, pero utilizaremos el archivo “orm-dps-v2.zip” que acabamos de generar para subir una pila customizada para Doguito.

Espero que salga todo bien y que tu pilla sea implementada con éxito, pero si tienes algún problema, puedes conversar con los demás colegas en el foro.




En este entrenamiento nuestro enfoque es en el aprendizaje de utilización de Oracle Cloud para casos prácticos, entretanto, debes haber visto que hablamos sobre varias herramientas auxiliares que podemos utilizar para trabajar en una Cloud.

Resource Manager de OCI es una de estas herramientas y que internamente utiliza scripts TerraForm para automatizar la implementación de infraestructura.

Si te interesaste por Terraform y quieres saber más sobre, te dejamos un artículo que tenemos en nuestro blog aquí.


https://www.aluracursos.com/blog/conociendo-terraform?utm_source=gnarus&utm_medium=timeline


¿Pero qué es Terraform?

Terraform es una herramienta bastante simple, pero muy poderosa que nos permite administrar toda la infraestructura utilizando código en archivos simples, concisos y declarativos.

Terraform es de código abierto (Open Source) y es desarrollado por HashiCorp, que también tiene otras herramientas que ustedes ya deben conocer, la más famosa es Vagrant, con la cual podemos provisionar ambientes aislados de nuestra máquina física para que podamos utilizarlos como entorno de desarrollo y ser lo más parecido posible de un servidor de producción, pero eso es tema de otro artículo.
Algunas funcionalidades de Terraform

Esta herramienta nos permite crear y/o cambiar versiones de infraestructura de nuestros entornos de manera eficiente y segura. Terraform utiliza archivos de configuración, en los que podemos informar de todos los recursos y componentes que nuestra infraestructura necesita y todavía podemos indicar un orden para la utilización de los recursos, donde podemos definir que un servicio necesita que otro sea iniciado y creado primero.

Con él podemos crear una sola máquina en los servicios en la nube como instancias EC2 (Elastic Compute Cloud) en AWS (Amazon Web Services) al cual la herramienta tiene soporte, o también podemos crear varias máquinas y así crear un Data Center entero y, sin embargo, configurar todo con pocas líneas de código y muy pocos archivos.

Otra característica importante que la herramienta tiene es el plan de ejecución, siempre podemos verificar la secuencia de ejecución de una infraestructura, así que podemos ver los pasos que Terraform ejecutará para alcanzar el estado descrito en el (los) archivo(s) de configuración.

Estos planes también son adaptables, por lo que en el momento en que cambiamos el (los) archivo(s) de configuración Terraform ofrece un nuevo plan con los cambios necesarios para que podamos analizar las modificaciones que se realizarán en el entorno.

Hasta ahora, hemos visto que Terraform tiene muchas características interesantes y que pueden ayudarnos de una manera muy positiva, pero ¿dónde podemos realmente utilizarlas?
Sus aplicaciones

Lo primero que podemos pensar es que si Terraform nos permite crear entornos, sería interesante utilizarlo en servicios en la nube, como AWS, Google Cloud Platform, Azure, puede consultar la lista con todos los proveedores aquí.

¿Y qué tienen en común todos estos servicios? Bueno, ellos nos permiten crear máquinas (hosts) para ponernos nuestras aplicaciones en producción y ese es el uso más común de Terraform, pero, ¿eso es todo lo que podemos hacer con Terraform?

No, esta herramienta también funciona con los niveles más bajos de nuestra infraestructura y nos permite también la manipulación de recursos como almacenamiento, red, instancias(hosts) como he dicho, y los recursos de más alto nivel, como el caso de DNS y recursos de Softwares como servicio(SaaS), es el caso do Heroku y otros.
Ventajas de Terraform

Al trabajar con Terraform tenemos muchas ventajas, pensar que en un equipo grande, a menudo necesitamos un ambiente para pruebas o para homologación o para evaluar la calidad de nuestras aplicaciones.

Por lo tanto, sería un gran desperdicio utilizar servicios en la nube, como instancias (hosts, máquinas), que tienen un costo considerable, y dejarlas la mayor parte del tiempo ociosas, sin utilización, ya que esas etapas (pruebas, homologación, evaluación) no son tan constantes, Terraform puede ayudarnos con eso.

Podemos crear un ambiente para pruebas en pocos minutos, ya configurado y listo para usar, y justo después de terminar todas las pruebas y verificaciones, podemos simplemente eliminar ese ambiente, y cuando lo necesitemos de nuevo, simplemente ejecute un comando y tendremos el ambiente listo de nuevo, eso es lo que llamamos un entorno desechable.
Conclusión

Hemos visto que Terraform es una herramienta muy poderosa para el área de DevOps, tiene una amplitud de uso muy grande y nos proporciona ambientes versátiles, personalizables y sobre todo compartibles y reutilizables.

Así que, es muy importante conocer una herramienta tan rica como esta, incluso si eres desarrollador y tu enfoque no esté en esa área. La herramienta también tiene una pequeña curva de aprendizaje que facilita la rápida utilización de la misma en las empresas, además de una documentación bastante completa.

Jonilson Sousa

Desarrollador de software en Grupo Alura. Trabajando con las más diversas tecnologías, como Java, Python, JavaScript, PHP y usando frameworks como SpringBoot, Flask. Tambien me gusta ver otras tecnologías o frameworks geniales por diversión




Lo que aprendimos en esta aula:

    Que podemos customizar los archivos Terraform para crear diversos tipos de recursos computacionales de una pilla de plementación.
    Que utilizamos el archivo cloud-init.yaml para customizar la instalación de softwares diversos en las instancias computacionales creadas a partir de una pilla.
    Que usamos el Almacenamiento de Objetos para guardar archivos de configuración que serán utilizados en la implementación de nuestras pillas de recursos.

